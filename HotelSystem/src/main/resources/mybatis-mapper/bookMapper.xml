<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="hotel.management.v1.client.book.dao.BookDao">
	<select id = "findBooknoByusername" resultType="int">
		select bookno from book where username = #{username}
	</select>
	<select id="findByusername" resultType="hotel.management.v1.client.book.dto.BookDto$finduser">
		select u.username,u.userlevel from users u where username = #{username}	
	</select>
	<select id="findRoomFromAndTo" resultType="hotel.management.v1.client.book.dto.BookDto$findRoom">
	select r.gradename,count(*)-(select count(*) from roombooking rb where rb.checkin &lt;  TO_DATE(#{from}, 'MM/DD/YYYY') and rb.checkout &gt; to_date(#{to},'MM/DD/YYYY')) as reservableOrNot,rp.breakfastprice,rp.gradeprice 
	from room r join roomprice rp on r.roomno = rp.roomno 
	GROUP BY r.gradename, rp.breakfastprice, rp.gradeprice
	</select>
	<insert id="addBook">
		insert into book
		values(BOOK_SEQ_BOOKNO.nextval,#{username},#{totalcnt},to_date(#{from},'MM/DD/YYYY'),#{booktel},#{booker},'체크인대기')
	</insert>
	<insert id="addRoomBooking">
		insert into roombooking select
		b.bookno,b.bookdate,to_date(#{checkOut},'MM/DD/YYYY'),#{bfcheckbox},null,#{gradename}
		from book b where b.username = #{username}
	</insert>
	<insert id="addDinner">
		insert into dinner select b.bookno,b.totalcount,150000 from book b where
		username=#{username}and b.bookno=#{bookno} and b.bookstatus = '체크인대기'
	</insert>
	<insert id="addDinnerbook">
		insert into dinner select
		b.bookno,b.totalcount,120000 from book b where b.username =
		#{username} and b.bookno = #{resno}
	</insert>
	<select id="findByUsernameAndBookdate" resultType="int">
		select
		b.bookno from book b where username = #{username} and bookdate =
		to_date(#{bookdate},'MM/DD/YYYY')
	</select>
	<select id="findBookdata" resultType="hotel.management.v1.client.book.dto.BookDto$data">
		select b.bookno,b.username from book b where b.username =
		#{username} and b.booktel = #{booktel} and b.booker = #{booker} and
		b.bookstatus = '체크인대기'
	</select>
	<select id = "findMydinnerByusername" resultType="hotel.management.v1.client.book.dto.BookDto$mypagedinner">
		select rb.checkin,rb.checkout,bk.booker,bk.booktel,rb.bookroomgrade from roombooking rb ,book bk where rb.bookno = bk.bookno and username = #{username}
	</select>
	</mapper>